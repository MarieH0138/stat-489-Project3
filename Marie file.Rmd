---
title: "Marie file"
output: html_document
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
# Cost function for cross validation #NEED TO MAKE OUR OWN
cost <- function(obs, pred) {
  outcome <- pred > 0.5
  return(1 - (sum(obs == outcome) / length(obs)))
}
# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(boot))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(randomForestSRC))

```


Predicting if QB "the team" tends to do some type of passing: deep, short, left or right. 
And if they are successful or not

Idea -> prediction model looking something like: 


model <- glm*/lm*(Final_position~starting_coordinates+initial_speed+initial_heading+position , data = train, family = "poisson")


logistic_cv2 <- cv.glm(train, model, cost, K=5)
logistic_cv2$delta


To get to this point I need to:
-decide what variables to use
-how to code those variables
-clean the data to remove the stupid variables HAH
-more cleaning. boo. 
- data exploration
-decide on a model that looks noice
-graphical representations
-see what the homies think about it 
-make it work. sigh


DECIDING ON VARIABLES
```{r}
input_2023_w01 <- read.csv("C:/Users/marie/Downloads/nfl-big-data-bowl-2026-prediction/train/input_2023_w01.csv")

#splitting by gameid
get_game_by_index <- function(df, index) {
  games <- df %>% group_split(game_id)
  return(games[[index]])
}

game1 <- get_game_by_index(input_2023_w01, 1)


# game1 = full tracking dataset for ONE game (want to make into reusable function that loops through each input file)
first_last <- game1 %>%
  group_by(game_id,play_id,nfl_id) %>%
  
# Identify the first & last rows for each player in each play
  summarize(
    # First frame
    x_1   = x[which.min(frame_id)],
    y_1   = y[which.min(frame_id)],
    s_1   = s[which.min(frame_id)],
    a_1   = a[which.min(frame_id)],
    dir_1 = dir[which.min(frame_id)],
    pos   = first(player_position),
    
    # Last frame
    x_last = x[which.max(frame_id)],
    y_last = y[which.max(frame_id)],
    
    .groups = "drop"
  )


```

Prediction timeeee

```{r}
#force it to predict both x and y coordinate at the same time 
A<- cbind(first_last$x_last,first_last$y_last)

#simplest model possible
model1 <- lm(
  A ~ x_1 + y_1 + s_1 + a_1 + dir_1 + pos,
  data = first_last_clean
)
summary(model1)
```

```{r}

#random tree hates missing values + character type so...
first_last_clean <- first_last %>% drop_na(x_last, y_last) 
first_last_clean <- first_last_clean %>% mutate(pos = as.factor(pos))

#this makes my R session just bug out and kick me out rip, I'm very sure I'm doing something wrong. But i wanna use ittttt
model2 <- rfsrc(Multivar(x_last, y_last) ~ x_1 + y_1 + s_1 + a_1 + dir_1 + pos, 
               data = first_last_clean)
```


